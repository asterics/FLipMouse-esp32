window.ws={},ws.initWebsocket=function(i,c,s,u){s=s||1500,u=u||0;var r=!1,n=new Promise(function(n,o){if(setTimeout(function(){r||(console.info("opening websocket timed out: "+i),t())},s),c&&c.readyState==c.OPEN)n(c);else{c&&c.close();var e=new WebSocket(i);e.onopen=function(){r?e.close():(console.info("websocket to opened! url: "+i),n(e))},e.onclose=function(){console.info("websocket closed! url: "+i),t()},e.onerror=function(){console.info("websocket error! url: "+i),t()}}function t(){u<=0?o():r||(r=!0,console.info("retrying connection to websocket! url: "+i+", remaining retries: "+(u-1)),ws.initWebsocket(i,null,s,u-1).then(n,o))}});return n.then(function(){r=!0},function(){r=!0}),n},ws.handleData=function(n,i,c){return c=c||3e3,new Promise(function(o){var e="",t=setTimeout(function(){o(e)},c);n.onmessage=function(n){n.data&&-1<n.data.indexOf(C.LIVE_VALUE_CONSTANT)?L.isFunction(i)&&i(n.data):(clearTimeout(t),e+=n.data+"\n",t=setTimeout(function(){console.log("got result: "+e),o(e)},200))}})};