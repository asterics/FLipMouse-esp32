<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.13"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>FLipMouse/FABI ESP32 firmware: /home/beni/Projects/FLipMouse-esp32/main/function_tasks/task_mqtt.h File Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">FLipMouse/FABI ESP32 firmware
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.13 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="dir_5c982d53a68cdbcd421152b4020263a9.html">main</a></li><li class="navelem"><a class="el" href="dir_dd44d79ba9a472f66a6851d54403189f.html">function_tasks</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="summary">
<a href="#define-members">Macros</a> &#124;
<a href="#func-members">Functions</a>  </div>
  <div class="headertitle">
<div class="title">task_mqtt.h File Reference</div>  </div>
</div><!--header-->
<div class="contents">

<p>CONTINOUS TASK - MQTT handling.  
<a href="#details">More...</a></p>
<div class="textblock"><code>#include &lt;freertos/FreeRTOS.h&gt;</code><br />
<code>#include &lt;freertos/event_groups.h&gt;</code><br />
<code>#include &lt;freertos/queue.h&gt;</code><br />
<code>#include &lt;freertos/task.h&gt;</code><br />
<code>#include &lt;esp_log.h&gt;</code><br />
<code>#include &quot;<a class="el" href="common_8h_source.html">common.h</a>&quot;</code><br />
<code>#include &lt;inttypes.h&gt;</code><br />
<code>#include &quot;<a class="el" href="hal__storage_8h_source.html">hal_storage.h</a>&quot;</code><br />
<code>#include &quot;lwip/sockets.h&quot;</code><br />
<code>#include &quot;lwip/dns.h&quot;</code><br />
<code>#include &quot;lwip/netdb.h&quot;</code><br />
<code>#include &quot;mqtt_client.h&quot;</code><br />
<code>#include &quot;esp_err.h&quot;</code><br />
<code>#include &quot;esp_wifi.h&quot;</code><br />
<code>#include &quot;esp_event_loop.h&quot;</code><br />
<code>#include &quot;esp_event_legacy.h&quot;</code><br />
<code>#include &quot;nvs.h&quot;</code><br />
<code>#include &quot;nvs_flash.h&quot;</code><br />
</div>
<p><a href="task__mqtt_8h_source.html">Go to the source code of this file.</a></p>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="define-members"></a>
Macros</h2></td></tr>
<tr class="memitem:abf45b50ab8b57f04bef31dc53b4ca880"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="task__mqtt_8h.html#abf45b50ab8b57f04bef31dc53b4ca880">TASK_MQTT_STACKSIZE</a>&#160;&#160;&#160;4096</td></tr>
<tr class="memdesc:abf45b50ab8b57f04bef31dc53b4ca880"><td class="mdescLeft">&#160;</td><td class="mdescRight">Stack size for the MQTT task.  <a href="#abf45b50ab8b57f04bef31dc53b4ca880">More...</a><br /></td></tr>
<tr class="separator:abf45b50ab8b57f04bef31dc53b4ca880"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a028c7f08d77e361f5624a8259b88788a"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="task__mqtt_8h.html#a028c7f08d77e361f5624a8259b88788a">MQTT_DELIMITER</a>&#160;&#160;&#160;':'</td></tr>
<tr class="memdesc:a028c7f08d77e361f5624a8259b88788a"><td class="mdescLeft">&#160;</td><td class="mdescRight">Default mqtt delimter character.  <a href="#a028c7f08d77e361f5624a8259b88788a">More...</a><br /></td></tr>
<tr class="separator:a028c7f08d77e361f5624a8259b88788a"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:ae7ad6f5bfc7cbfc9f6a223fcf697c8f6"><td class="memItemLeft" align="right" valign="top">esp_err_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="task__mqtt_8h.html#ae7ad6f5bfc7cbfc9f6a223fcf697c8f6">taskMQTTInit</a> (void)</td></tr>
<tr class="memdesc:ae7ad6f5bfc7cbfc9f6a223fcf697c8f6"><td class="mdescLeft">&#160;</td><td class="mdescRight">Init the MQTT task and the wifi.  <a href="#ae7ad6f5bfc7cbfc9f6a223fcf697c8f6">More...</a><br /></td></tr>
<tr class="separator:ae7ad6f5bfc7cbfc9f6a223fcf697c8f6"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ae09eb75c3fed43ee85fd92c1f710b600"><td class="memItemLeft" align="right" valign="top">esp_err_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="task__mqtt_8h.html#ae09eb75c3fed43ee85fd92c1f710b600">taskMQTTDeInit</a> (void)</td></tr>
<tr class="memdesc:ae09eb75c3fed43ee85fd92c1f710b600"><td class="mdescLeft">&#160;</td><td class="mdescRight">Deinit the MQTT task and the wifi.  <a href="#ae09eb75c3fed43ee85fd92c1f710b600">More...</a><br /></td></tr>
<tr class="separator:ae09eb75c3fed43ee85fd92c1f710b600"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a6afc039be68c1a831778fe33bd2412a9"><td class="memItemLeft" align="right" valign="top">esp_err_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="task__mqtt_8h.html#a6afc039be68c1a831778fe33bd2412a9">taskMQTTPublish</a> (char *topic_payload)</td></tr>
<tr class="memdesc:a6afc039be68c1a831778fe33bd2412a9"><td class="mdescLeft">&#160;</td><td class="mdescRight">Publish data via MQTT.  <a href="#a6afc039be68c1a831778fe33bd2412a9">More...</a><br /></td></tr>
<tr class="separator:a6afc039be68c1a831778fe33bd2412a9"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><p>CONTINOUS TASK - MQTT handling. </p>
<p>This module is used for connecting the FLipMouse/FABI to a MQTT broker.</p>
<dl class="section warning"><dt>Warning</dt><dd>Please note, only one WiFi mode is possible: either this device operates in AP mode and serves the webGUI (see <a class="el" href="task__webgui_8h.html" title="CONTINOUS TASK - Web server &amp; WebGUI handling. ">task_webgui.h</a>) OR it operates in station mode, connects to a given Wifi and transmits data via MQTT (if enabled) </dd></dl>
<dl class="section note"><dt>Note</dt><dd>Initialise this module only if a MQTT command is used in the configuration. </dd></dl>
<dl class="section see"><dt>See also</dt><dd><a class="el" href="task__webgui_8h.html" title="CONTINOUS TASK - Web server &amp; WebGUI handling. ">task_webgui.h</a> </dd></dl>

<p class="definition">Definition in file <a class="el" href="task__mqtt_8h_source.html">task_mqtt.h</a>.</p>
</div><h2 class="groupheader">Macro Definition Documentation</h2>
<a id="a028c7f08d77e361f5624a8259b88788a"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a028c7f08d77e361f5624a8259b88788a">&#9670;&nbsp;</a></span>MQTT_DELIMITER</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define MQTT_DELIMITER&#160;&#160;&#160;':'</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Default mqtt delimter character. </p>
<dl class="section note"><dt>Note</dt><dd>This is the default character, if no other is set via "AT MS". It is used to split the "AT MQ" string into topic and payload. </dd></dl>

<p class="definition">Definition at line <a class="el" href="task__mqtt_8h_source.html#l00069">69</a> of file <a class="el" href="task__mqtt_8h_source.html">task_mqtt.h</a>.</p>

</div>
</div>
<a id="abf45b50ab8b57f04bef31dc53b4ca880"></a>
<h2 class="memtitle"><span class="permalink"><a href="#abf45b50ab8b57f04bef31dc53b4ca880">&#9670;&nbsp;</a></span>TASK_MQTT_STACKSIZE</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define TASK_MQTT_STACKSIZE&#160;&#160;&#160;4096</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Stack size for the MQTT task. </p>

<p class="definition">Definition at line <a class="el" href="task__mqtt_8h_source.html#l00064">64</a> of file <a class="el" href="task__mqtt_8h_source.html">task_mqtt.h</a>.</p>

</div>
</div>
<h2 class="groupheader">Function Documentation</h2>
<a id="ae09eb75c3fed43ee85fd92c1f710b600"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ae09eb75c3fed43ee85fd92c1f710b600">&#9670;&nbsp;</a></span>taskMQTTDeInit()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">esp_err_t taskMQTTDeInit </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Deinit the MQTT task and the wifi. </p>
<p>This function deactives MQTT/WiFi in station mode. It is necessary if the webGUI should be switched on.</p>
<dl class="section return"><dt>Returns</dt><dd>ESP_OK on success, ESP_FAIL otherwise </dd></dl>

<p class="definition">Definition at line <a class="el" href="task__mqtt_8c_source.html#l00251">251</a> of file <a class="el" href="task__mqtt_8c_source.html">task_mqtt.c</a>.</p>

</div>
</div>
<a id="ae7ad6f5bfc7cbfc9f6a223fcf697c8f6"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ae7ad6f5bfc7cbfc9f6a223fcf697c8f6">&#9670;&nbsp;</a></span>taskMQTTInit()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">esp_err_t taskMQTTInit </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Init the MQTT task and the wifi. </p>
<p>This init function initializes the wifi in station mode and the MQTT task.</p>
<dl class="section see"><dt>See also</dt><dd><a class="el" href="common_8h.html#a491fd65b6e1cef337b9a99ac4f6002bb" title="NVS key for wifi name (when connected as client!) ">NVS_STATIONNAME</a> </dd>
<dd>
<a class="el" href="common_8h.html#ad33120b91260e67b77c9e3888c47d990" title="NVS key for wifi password (when connected as client!) ">NVS_STATIONPW</a> </dd>
<dd>
<a class="el" href="common_8h.html#a90072969f5970a88eb341d777d1f9e7c" title="NVS key for the MQTT broker. ">NVS_MQTT_BROKER</a> </dd></dl>
<dl class="section note"><dt>Note</dt><dd>Please activate only if necessary by any configuration. </dd></dl>
<dl class="section return"><dt>Returns</dt><dd>ESP_OK on success, ESP_FAIL otherwise </dd></dl>
<p>MQTT broker host name/ip </p>

<p class="definition">Definition at line <a class="el" href="task__mqtt_8c_source.html#l00144">144</a> of file <a class="el" href="task__mqtt_8c_source.html">task_mqtt.c</a>.</p>

<p class="reference">Referenced by <a class="el" href="task__mqtt_8c_source.html#l00281">taskMQTTPublish()</a>.</p>
<div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="task__mqtt_8h_ae7ad6f5bfc7cbfc9f6a223fcf697c8f6_cgraph.png" border="0" usemap="#task__mqtt_8h_ae7ad6f5bfc7cbfc9f6a223fcf697c8f6_cgraph" alt=""/></div>
<map name="task__mqtt_8h_ae7ad6f5bfc7cbfc9f6a223fcf697c8f6_cgraph" id="task__mqtt_8h_ae7ad6f5bfc7cbfc9f6a223fcf697c8f6_cgraph">
</map>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="task__mqtt_8h_ae7ad6f5bfc7cbfc9f6a223fcf697c8f6_icgraph.png" border="0" usemap="#task__mqtt_8h_ae7ad6f5bfc7cbfc9f6a223fcf697c8f6_icgraph" alt=""/></div>
<map name="task__mqtt_8h_ae7ad6f5bfc7cbfc9f6a223fcf697c8f6_icgraph" id="task__mqtt_8h_ae7ad6f5bfc7cbfc9f6a223fcf697c8f6_icgraph">
</map>
</div>

</div>
</div>
<a id="a6afc039be68c1a831778fe33bd2412a9"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a6afc039be68c1a831778fe33bd2412a9">&#9670;&nbsp;</a></span>taskMQTTPublish()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">esp_err_t taskMQTTPublish </td>
          <td>(</td>
          <td class="paramtype">char *&#160;</td>
          <td class="paramname"><em>topic_payload</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Publish data via MQTT. </p>
<p>This function publishes the given data. The parameter topic_payload will be split into the topic name and the corresponding payload to publish. The splitting is done by the currently set MQTT delimiter character, which can be modified with "AT MS". MQTT_DELIMITER will be used if no other character is set.</p>
<dl class="section see"><dt>See also</dt><dd><a class="el" href="task__mqtt_8h.html#a028c7f08d77e361f5624a8259b88788a" title="Default mqtt delimter character. ">MQTT_DELIMITER</a> </dd></dl>
<dl class="section return"><dt>Returns</dt><dd>ESP_OK on success, ESP_FAIL otherwise </dd></dl>

<p class="definition">Definition at line <a class="el" href="task__mqtt_8c_source.html#l00281">281</a> of file <a class="el" href="task__mqtt_8c_source.html">task_mqtt.c</a>.</p>

<p class="reference">Referenced by <a class="el" href="task__commands_8c_source.html#l00944">cmdMq()</a>, and <a class="el" href="handler__vb_8c_source.html#l00071">handler_vb()</a>.</p>
<div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="task__mqtt_8h_a6afc039be68c1a831778fe33bd2412a9_cgraph.png" border="0" usemap="#task__mqtt_8h_a6afc039be68c1a831778fe33bd2412a9_cgraph" alt=""/></div>
<map name="task__mqtt_8h_a6afc039be68c1a831778fe33bd2412a9_cgraph" id="task__mqtt_8h_a6afc039be68c1a831778fe33bd2412a9_cgraph">
</map>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="task__mqtt_8h_a6afc039be68c1a831778fe33bd2412a9_icgraph.png" border="0" usemap="#task__mqtt_8h_a6afc039be68c1a831778fe33bd2412a9_icgraph" alt=""/></div>
<map name="task__mqtt_8h_a6afc039be68c1a831778fe33bd2412a9_icgraph" id="task__mqtt_8h_a6afc039be68c1a831778fe33bd2412a9_icgraph">
</map>
</div>

</div>
</div>
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.13
</small></address>
</body>
</html>
